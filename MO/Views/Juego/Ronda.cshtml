@{
    ViewData["Title"] = "Pregunta";
}


<div class="botones-superiores">
    <button id="btnOmitir" type="button">Omitir</button>
    <button id="btnSalir" type="button">Salir</button>
</div>

<div class="pregunta-container">
    <h3 class="pregunta-titulo">@ViewBag.Pregunta.texto_pregunta</h3>
    <div id="timer">@ViewBag.Tiempo segundos restantes</div>

    <div class="contador">
        Correctas: <span id="correctas">@ViewBag.Correctas</span> ✅
        Incorrectas: <span id="incorrectas">@ViewBag.Incorrectas</span> ❌
    </div>

    <form id="formPregunta" method="post" action="/Juego/Responder">
        <input type="hidden" name="idPregunta" value="@ViewBag.Pregunta.id_pregunta" />
        <input type="hidden" id="idRespuesta" name="idRespuesta" value="" />
        <input type="hidden" id="tiempoTomado" name="tiempoTomado" value="0" />

        @foreach (var r in ViewBag.Respuestas)
        {
            <div class="opcion"
                 data-correcta="@r.es_correcta.ToString().ToLower()"
                 onclick="seleccionarRespuesta(this, @r.id_respuesta)">
                @r.texto_respuesta
            </div>
        }
    </form>
</div>
<script>
   
    let tiempoRestante = @ViewBag.Tiempo; 
    let tiempoInicio = new Date().getTime();
    let correctas = @ViewBag.Correctas; // contador de  correctas
    let incorrectas = @ViewBag.Incorrectas; // contador de r incorrectas

    // actualizar el timer cada segundo
    function actualizarTimer() {
        document.getElementById("timer").innerText = tiempoRestante + " segundos restantes";
        tiempoRestante--;
        if (tiempoRestante < 0) {
            // si se acaba el tiempo, marcar como no respondida y enviar formulario
            document.getElementById("idRespuesta").value = 0; // no respondió
            document.getElementById("tiempoTomado").value = 61;
            document.getElementById("formPregunta").submit();
        } else {
            setTimeout(actualizarTimer, 1000);
        }
    }

  
    function seleccionarRespuesta(div, idResp) {
        const opciones = document.getElementsByClassName("opcion");
        for (let i = 0; i < opciones.length; i++) opciones[i].onclick = null; // desactivar clicks

        const esCorrecta = div.getAttribute("data-correcta") === "true";
        div.classList.add(esCorrecta ? "correcta" : "incorrecta"); // colorear según correcta o incorrecta

        // actualizar contadores
        if (esCorrecta) correctas++; else incorrectas++;
        document.getElementById("correctas").innerText = correctas;
        document.getElementById("incorrectas").innerText = incorrectas;

        document.getElementById("idRespuesta").value = idResp; // guardar id respuesta
        let tiempoActual = new Date().getTime();
        document.getElementById("tiempoTomado").value = Math.floor((tiempoActual - tiempoInicio)/1000); // calcular tiempo tomado

        // enviar dsp medio segundo
        setTimeout(function() { document.getElementById("formPregunta").submit(); }, 500);
    }

    // botón omitir
    document.getElementById("btnOmitir").onclick = function() {
        document.getElementById("idRespuesta").value = 0; // marcar como no respondida
        let tiempoActual = new Date().getTime();
        document.getElementById("tiempoTomado").value = Math.floor((tiempoActual - tiempoInicio)/1000);
        document.getElementById("formPregunta").submit();
    };

    // botón salir de la partida
    document.getElementById("btnSalir").onclick = function() {
        window.location.href = "/Home/MenuPrincipal"; // ir al menú principal
    };

    // iniciar timer al cargar la página
    window.onload = actualizarTimer;
</script>


<style>
   
    .botones-superiores {
        max-width: 1000px;
        width: 85%;
        margin: 10px auto 0 auto;
        display: flex;
        justify-content: flex-end;
        gap: 10px;
    }

    #btnOmitir, #btnSalir {
        padding: 8px 12px;
        border-radius: 8px;
        border: none;
        color: #fff;
        font-weight: bold;
        cursor: pointer;
        box-shadow: 0 3px 6px rgba(0,0,0,0.2);
        transition: all 0.2s ease;
    }

    #btnOmitir {
        background-color: #ff9800;
    }

        #btnOmitir:hover {
            background-color: #e68900;
            transform: scale(1.05);
        }

    #btnSalir {
        background-color: #f44336;
    }

        #btnSalir:hover {
            background-color: #d32f2f;
            transform: scale(1.05);
        }

   
    .pregunta-container {
        background: linear-gradient(135deg, #1a1a2e, #101540);
        border-radius: 20px;
        padding: 20px 25px;
        max-width: 1000px;
        width: 85%;
        margin: 10px auto 20px auto;
        box-shadow: 0 8px 20px rgba(0,0,0,0.4);
        display: flex;
        flex-direction: column;
        align-items: center;
        transition: transform 0.2s ease, box-shadow 0.2s ease;
        word-wrap: break-word; 
    }

        .pregunta-container:hover {
            transform: translateY(-2px) scale(1.01);
            box-shadow: 0 12px 25px rgba(0,0,0,0.5);
        }

   
    .pregunta-titulo {
        color: #fff;
        font-size: 1.5rem;
        font-weight: 900;
        text-align: center;
        margin-bottom: 15px;
    }

    #timer {
        font-size: 18px;
        font-weight: bold;
        color: #ff3b3b;
        margin-bottom: 15px;
    }

    .contador {
        margin-bottom: 10px;
        font-size: 15px;
        white-space: nowrap;
    }

        .contador span {
            font-size: 16px;
            font-weight: bold;
            margin: 0 5px;
        }

    .opcion {
        background: #fff;
        color: #000;
        border-radius: 12px;
        padding: 12px 25px;
        margin: 8px 0;
        width: 100%; 
        max-width: 950px; 
        border: 2px solid #6a11cb;
        cursor: pointer;
        font-weight: bold;
        font-size: 1rem;
        transition: all 0.2s ease;
        text-align: center;
        white-space: normal; 
        word-wrap: break-word; 
        box-sizing: border-box;
    }



    .correcta {
        background-color: #4caf50 !important;
        color: #fff;
    }

    .incorrecta {
        background-color: #f44336 !important;
        color: #fff;
    }

    input[type="hidden"] {
        display: none;
    }

    
    @@media (max-width: 1024px) {
        .pregunta-container

    {
        width: 90%;
    }

    .opcion {
        width: 90%;
        font-size: 0.95rem;
    }

    .pregunta-titulo {
        font-size: 1.4rem;
    }

    }

    @@media (max-width: 768px) {
        .pregunta-container

    {
        width: 95%;
        padding: 15px 20px;
    }

    .opcion {
        width: 100%;
        font-size: 0.9rem;
    }

    .pregunta-titulo {
        font-size: 1.3rem;
    }

    .contador {
        white-space: normal;
    }

    }
</style>
